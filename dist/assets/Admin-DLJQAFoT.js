import{_ as I,o as r,c as u,n as F,k as L,l as W,m as J,p as Q,q as U,s as X,u as Y,x as Z,y as $,z as O,a as n,i as k,v as S,f as y,A as ee,e as M,w as z,T as te,F as B,d as D,B as oe,C as A,r as T,b as E}from"./index-DYGN9gRD.js";import{_ as ne}from"./loading-DG9tPhpA.js";const ie={props:["collection","selectCollectionAlias"]},le=["innerHTML"];function se(e,t,o,c,s,i){return r(),u("button",{class:F(["btn btn-sm rounded-0 text-start w-100 m-0",o.selectCollectionAlias===o.collection.alias?"btn-warning":"btn-light"]),onClick:t[0]||(t[0]=d=>e.$emit("select-collection",o.collection.alias)),innerHTML:o.collection.title},null,10,le)}const ce=I(ie,[["render",se]]),ae={props:["doc","selectDocId"]},re=["innerHTML"];function de(e,t,o,c,s,i){return r(),u("button",{class:F(["btn btn-sm rounded-0 text-start w-100 m-0",o.selectDocId===o.doc.id?"btn-warning":"btn-light"]),onClick:t[0]||(t[0]=d=>e.$emit("select-doc",o.doc.id)),innerHTML:o.doc.title},null,10,re)}const ue=I(ae,[["render",de]]);var me=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],fe=function(e){return me.map(function(t){return t.toLowerCase()}).indexOf(e.toLowerCase())!==-1},ve=function(e,t,o){Object.keys(t).filter(fe).forEach(function(c){var s=t[c];typeof s=="function"&&(c==="onInit"?s(e,o):o.on(c.substring(2),function(i){return s(i,o)}))})},ge=function(e,t,o,c){var s=e.modelEvents?e.modelEvents:null,i=Array.isArray(s)?s.join(" "):s;L(c,function(d,l){o&&typeof d=="string"&&d!==l&&d!==o.getContent({format:e.outputFormat})&&o.setContent(d)}),o.on(i||"change input undo redo",function(){t.emit("update:modelValue",o.getContent({format:e.outputFormat}))})},be=function(e,t,o,c,s,i){c.setContent(i()),o.attrs["onUpdate:modelValue"]&&ge(t,o,c,s),ve(e,o.attrs,c)},j=0,q=function(e){var t=Date.now(),o=Math.floor(Math.random()*1e9);return j++,e+"_"+o+j+String(t)},he=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},N=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},ye=function(e,t){return N(e).concat(N(t))},_e=function(e){return e==null},P=function(){return{listeners:[],scriptId:q("tiny-script"),scriptLoaded:!1}},pe=function(){var e=P(),t=function(s,i,d,l){var a=i.createElement("script");a.referrerPolicy="origin",a.type="application/javascript",a.id=s,a.src=d;var b=function(){a.removeEventListener("load",b),l()};a.addEventListener("load",b),i.head&&i.head.appendChild(a)},o=function(s,i,d){e.scriptLoaded?d():(e.listeners.push(d),s.getElementById(e.scriptId)||t(e.scriptId,s,i,function(){e.listeners.forEach(function(l){return l()}),e.scriptLoaded=!0}))},c=function(){e=P()};return{load:o,reinitialize:c}},Ce=pe(),ke=function(){return typeof window<"u"?window:global},_=function(){var e=ke();return e&&e.tinymce?e.tinymce:null},De={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},g=function(){return g=Object.assign||function(e){for(var t,o=1,c=arguments.length;o<c;o++){t=arguments[o];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},g.apply(this,arguments)},we=function(e,t,o,c){return e(c||"div",{id:t,ref:o})},Se=function(e,t,o){return e("textarea",{id:t,visibility:"hidden",ref:o})},V={selector:void 0,target:void 0},Ie=W({props:De,setup:function(e,t){var o=e.init?g(g({},e.init),V):g({},V),c=J(e),s=c.disabled,i=c.modelValue,d=c.tagName,l=Q(null),a=null,b=e.id||q("tiny-vue"),v=e.init&&e.init.inline||e.inline,h=!!t.attrs["onUpdate:modelValue"],x=!0,H=e.initialValue?e.initialValue:"",w="",K=function(m){return h?function(){return i!=null&&i.value?i.value:""}:function(){return m?H:w}},C=function(){var m=K(x),f=g(g({},o),{readonly:e.disabled,target:l.value,plugins:ye(o.plugins,e.plugins),toolbar:e.toolbar||o.toolbar,inline:v,setup:function(p){a=p,p.on("init",function(G){return be(G,e,t,p,i,m)}),typeof o.setup=="function"&&o.setup(p)}});he(l.value)&&(l.value.style.visibility=""),_().init(f),x=!1};L(s,function(m){var f;a!==null&&(typeof((f=a.mode)===null||f===void 0?void 0:f.set)=="function"?a.mode.set(m?"readonly":"design"):a.setMode(m?"readonly":"design"))}),L(d,function(m){var f;h||(w=a.getContent()),(f=_())===null||f===void 0||f.remove(a),U(function(){return C()})}),X(function(){if(_()!==null)C();else if(l.value&&l.value.ownerDocument){var m=e.cloudChannel?e.cloudChannel:"7",f=e.apiKey?e.apiKey:"no-api-key",p=_e(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(f,"/tinymce/").concat(m,"/tinymce.min.js"):e.tinymceScriptSrc;Ce.load(l.value.ownerDocument,p,C)}}),Y(function(){_()!==null&&_().remove(a)}),v||(Z(function(){x||C()}),$(function(){var m;h||(w=a.getContent()),(m=_())===null||m===void 0||m.remove(a)}));var R=function(m){var f;w=a.getContent(),(f=_())===null||f===void 0||f.remove(a),o=g(g(g({},o),m),V),U(function(){return C()})};return t.expose({rerender:R,getEditor:function(){return a}}),function(){return v?we(O,b,l,e.tagName):Se(O,b,l)}}});const xe={components:{Editor:Ie},props:["doc","collection","length"],methods:{copyToBuffer(e){e.target.parentNode.parentNode.childNodes[0].select(),document.execCommand("copy")},saveItem(){this.$store.dispatch("updateItem",{item:this.doc})},async removeImage(){},async uploadImage(e){},async saveDoc(){let e={};if(this.doc.title){e={id:this.doc.id||Date.now().toString(),title:this.doc.title.trim(),alias:this.doc.alias||"",position:+this.doc.position,active:this.doc.active,desc:this.doc.desc||"","img.url":"","img.name":""};try{this.doc.id||await this.$store.dispatch("addDoc",{collection:this.collection,doc:e})}catch{}finally{}}},async removeDoc(){if(confirm("Точно удалить?"))try{await this.removeImage(),await this.$store.dispatch("removeDoc",{collection:this.collection,id:this.doc.id})}catch{}finally{}}}},Ae={class:"row"},Ee={class:"col-12"},Ve={class:"col-12"},Le={class:"row mt-3 p-3"},Me={class:"col-6"},Be={class:"form-group row bg-light border p-2 pe-4"},Ue={class:"col-4"},Oe={class:"col-4 pt-1"},Te={class:"form-check"},je={key:0,class:"row"},Ne={class:"col-12"},Pe={key:1,class:"row mt-3 p-3"},Fe={class:"col-6 text-start bg-light p-3"},ze={class:"form-group"},qe=["disabled"],He={key:0,class:"col-6 bg-light p-3"},Ke=["src"],Re={key:2,class:"row"},Ge={class:"col-12"},We={class:"form-group text-start"},Je={class:"input-group input-group-sm mb-3"},Qe={class:"input-group-append"},Xe={class:"row border-top mt-3 p-3"},Ye={class:"col-12 col-sm-6 col-md-4"},Ze=["disabled"],$e={class:"col-12 col-sm-6 col-md-4"};function et(e,t,o,c,s,i){const d=D("Editor");return r(),u(B,null,[n("div",Ae,[n("div",Ee,[k(n("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>o.doc.title=l),class:"form-control form-control-sm",placeholder:"Заголовок",maxlength:"70",required:""},null,512),[[S,o.doc.title,void 0,{trim:!0}]])]),n("div",Ve,[o.collection==="menus"||o.collection==="napravs"||o.collection==="prices"?k((r(),u("input",{key:0,type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>o.doc.alias=l),class:"form-control form-control-sm",placeholder:"Алиас",required:""},null,512)),[[S,o.doc.alias,void 0,{trim:!0}]]):y("",!0)])]),n("div",Le,[n("div",Me,[n("div",Be,[t[12]||(t[12]=n("label",{for:"position",class:"col-4 pt-1"},"Позиция",-1)),n("div",Ue,[k(n("input",{type:"number",id:"position",min:"0",max:"42",step:"1","onUpdate:modelValue":t[2]||(t[2]=l=>o.doc.position=l),required:"",class:"form-control form-control-sm"},null,512),[[S,o.doc.position,void 0,{number:!0}]])]),n("div",Oe,[n("div",Te,[k(n("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=l=>o.doc.active=l),id:"active"},null,512),[[ee,o.doc.active]]),t[11]||(t[11]=n("label",{class:"form-check-label",for:"active"},"Активна",-1))])])])]),t[13]||(t[13]=n("div",{class:"col-6 text-start"},null,-1))]),o.collection==="portfolios"||o.collection==="prices"&&o.doc.id||o.collection==="contacts"?(r(),u("div",je,[n("div",Ne,[M(d,{"api-key":"hanxollva4phpflvvnv1lje4y82fvprrkqrmpqeclw066js2",class:"form-control form-control-sm",modelValue:o.doc.desc,"onUpdate:modelValue":t[4]||(t[4]=l=>o.doc.desc=l),init:{language:"ru",toolbar_mode:"sliding",plugins:"anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks code wordcount",toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat | tools",menu:{tools:{title:"Tools",items:"code"}}},"initial-value":"Welcome to TinyMCE!"},null,8,["modelValue"])])])):y("",!0),o.collection!="menus"||o.collection!="contacts"?(r(),u("div",Pe,[n("div",Fe,[n("div",ze,[t[14]||(t[14]=n("label",{for:"img",class:"small"},"Изображение (max 5 Мб)",-1)),n("input",{type:"file",class:"form-control-file",id:"img",accept:"image/png, image/jpeg",disabled:!o.doc.id,onChange:t[5]||(t[5]=(...l)=>i.uploadImage&&i.uploadImage(...l))},null,40,qe)])]),o.doc.id?(r(),u("div",He,[o.doc["img.name"]?(r(),u("img",{key:0,src:o.doc["img.url"],alt:"Изображение",class:"",height:"76"},null,8,Ke)):y("",!0),o.doc["img.name"]?(r(),u("button",{key:1,class:"btn btn-sm btn-light border position-relative load-image",type:"button",onClick:t[6]||(t[6]=(...l)=>i.removeImage&&i.removeImage(...l))}," Удалить ")):y("",!0)])):y("",!0)])):y("",!0),o.collection==="prices"&&o.doc.id?(r(),u("div",Re,[n("div",Ge,[n("div",We,[t[15]||(t[15]=n("label",{for:"imgSrc",class:"small"},"Сылка на изображение",-1)),n("div",Je,[k(n("input",{type:"text",class:"form-control",placeholder:"Здесь появится ссылка",id:"imgSrc","onUpdate:modelValue":t[7]||(t[7]=l=>o.doc["img.url"]=l)},null,512),[[S,o.doc["img.url"],void 0,{trim:!0}]]),n("div",Qe,[n("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[8]||(t[8]=(...l)=>i.copyToBuffer&&i.copyToBuffer(...l))}," Копировать ")])])])])])):y("",!0),n("div",Xe,[n("div",Ye,[M(te,{name:"fade",mode:"out-in"},{default:z(()=>[n("button",{onClick:t[9]||(t[9]=(...l)=>i.removeDoc&&i.removeDoc(...l)),type:"button",class:"btn btn-sm btn-block btn-outline-danger",disabled:!o.doc.id}," Удалить документ ",8,Ze)]),_:1})]),t[16]||(t[16]=n("div",{class:"d-none d-md-block col-4"},null,-1)),n("div",$e,[n("button",{type:"submit",class:"btn btn-sm btn-block btn-outline-success",onClick:t[10]||(t[10]=(...l)=>i.saveItem&&i.saveItem(...l))}," Сохранить изменения ")])])],64)}const tt=I(xe,[["render",et],["__scopeId","data-v-21be3bfe"]]),ot={components:{CollectionsList:ce,Docs:ue,Form:tt},data(){return{loadingCol:!0,selectCollectionAlias:"",selectDocId:"",createDoc:!1,docs:[],doc:{}}},computed:{collections(){return this.$store.getters.collections},...oe(["clients","menus","napravs","portfolios","prices","sliders","zadachi","contacts"])},async mounted(){try{this.loadingCol=!1}catch(t){console.log("Ошибка при получении коллекций в Админ:",t.message)}finally{}const e=document.querySelector("#jvlabelWrap");e&&e.classList.add("d-none")},methods:{selectCollection(e){this.createDoc=!1,this.selectDocId="",this.selectCollectionAlias=e,this.docs=this[e]},selectDoc(e){this.createDoc=!1,this.selectDocId=e,this.doc=this.docs.find(t=>t.id===e)},async logOut(){await this.$store.dispatch("logOut")},createNewDoc(){this.createDoc=!0,this.selectDocId="",this.doc={active:!0,position:this.docs.length+1}}}},nt={class:"p-1 p-lg-5 bg-dark vh-100 bg-image"},it={class:"bg-white shadow-sm rounded-lg admin-block"},lt={class:"container-fluid"},st={class:"row"},ct={class:"col-12 border-bottom p-3 text-start"},at={class:"m-0 mt-2 text-muted d-inline-block"},rt={class:"row"},dt={class:"col-3 col-md-2 border-end p-0 overflow-auto admin-sidebar"},ut={key:0,src:ne,alt:"Loading..."},mt={key:1},ft={class:"col-3 col-md-2 p-0 border-end overflow-auto admin-sidebar"},vt={class:"text-center m-0 mt-2 pb-2 border-bottom"},gt=["disabled"],bt={class:"col-6 col-md-8 pt-3 pb-3 overflow-auto admin-form"},ht={key:1},yt={key:2};function _t(e,t,o,c,s,i){const d=D("router-link"),l=D("CollectionsList"),a=D("Docs"),b=D("Form");return r(),u("div",nt,[n("div",it,[n("div",lt,[n("div",st,[n("div",ct,[n("h6",at,[t[3]||(t[3]=A(" Admin panel ")),M(d,{to:"/",class:"navbar-brand"},{default:z(()=>t[2]||(t[2]=[A(" H ")])),_:1})]),n("button",{onClick:t[0]||(t[0]=(...v)=>i.logOut&&i.logOut(...v)),class:"btn btn-sm btn-light text-muted float-end"}," Logout "),t[4]||(t[4]=n("span",{class:"d-inline-block float-end text-muted small mt-2 me-3"},"UsEmail",-1))])]),n("div",rt,[n("div",dt,[t[5]||(t[5]=n("h6",{class:"text-center m-0 mt-2 pb-2 border-bottom"},"Коллекции",-1)),s.loadingCol?(r(),u("img",ut)):(r(),u("div",mt,[(r(!0),u(B,null,T(i.collections,(v,h)=>(r(),E(l,{key:"cole"+h,collection:v,selectCollectionAlias:s.selectCollectionAlias,onSelectCollection:i.selectCollection},null,8,["collection","selectCollectionAlias","onSelectCollection"]))),128))]))]),n("div",ft,[n("h6",vt,[t[6]||(t[6]=A(" Документы ")),n("button",{onClick:t[1]||(t[1]=(...v)=>i.createNewDoc&&i.createNewDoc(...v)),class:"btn btn-sm btn-outline-primary p-0 ps-2 pe-2 ms-1",disabled:!s.selectCollectionAlias,title:"Создать документ"}," + ",8,gt)]),(r(!0),u(B,null,T(s.docs,(v,h)=>(r(),E(a,{key:"doc"+h,doc:v,selectDocId:s.selectDocId,onSelectDoc:i.selectDoc},null,8,["doc","selectDocId","onSelectDoc"]))),128))]),n("div",bt,[s.selectCollectionAlias&&(s.selectDocId||s.createDoc)?(r(),E(b,{key:0,doc:s.doc,collection:s.selectCollectionAlias,length:s.docs.length},null,8,["doc","collection","length"])):s.selectCollectionAlias?(r(),u("h6",yt,"Выберите Документ")):(r(),u("h6",ht,"Выберите Коллекцию"))])])])])])}const kt=I(ot,[["render",_t],["__scopeId","data-v-cfcab695"]]);export{kt as default};
